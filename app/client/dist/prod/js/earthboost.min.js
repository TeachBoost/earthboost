!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.page=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){"use strict";function d(a,b){if("function"==typeof a)return d("*",a);if("function"==typeof b)for(var c=new h(a),e=1;e<arguments.length;++e)d.callbacks.push(c.middleware(arguments[e]));else"string"==typeof a?d["string"==typeof b?"redirect":"show"](a,b):d.start(a)}function e(a){if(!a.handled){var b;b=t?s+p.hash.replace("#!",""):p.pathname+p.search,b!==a.canonicalPath&&(d.stop(),a.handled=!1,p.href=a.canonicalPath)}}function f(a){return"string"!=typeof a?a:r?decodeURIComponent(a.replace(/\+/g," ")):a}function g(a,b){"/"===a[0]&&0!==a.indexOf(s)&&(a=s+(t?"#!":"")+a);var c=a.indexOf("?");if(this.canonicalPath=a,this.path=a.replace(s,"")||"/",t&&(this.path=this.path.replace("#!","")||"/"),this.title=document.title,this.state=b||{},this.state.path=a,this.querystring=~c?f(a.slice(c+1)):"",this.pathname=f(~c?a.slice(0,c):a),this.params={},this.hash="",!t){if(!~this.path.indexOf("#"))return;var d=this.path.split("#");this.path=d[0],this.hash=f(d[1])||"",this.querystring=this.querystring.split("#")[0]}}function h(a,b){b=b||{},this.path="*"===a?"(.*)":a,this.method="GET",this.regexp=l(this.path,this.keys=[],b)}function i(a){if(1===j(a)&&!(a.metaKey||a.ctrlKey||a.shiftKey||a.defaultPrevented)){for(var b=a.path?a.path[0]:a.target;b&&"A"!==b.nodeName;)b=b.parentNode;if(b&&"A"===b.nodeName&&!b.hasAttribute("download")&&"external"!==b.getAttribute("rel")){var e=b.getAttribute("href");if((t||b.pathname!==p.pathname||!b.hash&&"#"!==e)&&!(e&&e.indexOf("mailto:")>-1)&&!b.target&&k(b.href)){var f=b.pathname+b.search+(b.hash||"");"undefined"!=typeof c&&f.match(/^\/[a-zA-Z]:\//)&&(f=f.replace(/^\/[a-zA-Z]:\//,"/"));var g=f;0===f.indexOf(s)&&(f=f.substr(s.length)),t&&(f=f.replace("#!","")),s&&g===f||(a.preventDefault(),d.show(g))}}}}function j(a){return a=a||window.event,null===a.which?a.button:a.which}function k(a){var b=p.protocol+"//"+p.hostname;return p.port&&(b+=":"+p.port),a&&0===a.indexOf(b)}var l=a("path-to-regexp");b.exports=d;var m,n,o="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",p="undefined"!=typeof window&&(window.history.location||window.location),q=!0,r=!0,s="",t=!1;d.callbacks=[],d.exits=[],d.current="",d.len=0,d.base=function(a){return 0===arguments.length?s:void(s=a)},d.start=function(a){if(a=a||{},!m&&(m=!0,!1===a.dispatch&&(q=!1),!1===a.decodeURLComponents&&(r=!1),!1!==a.popstate&&window.addEventListener("popstate",u,!1),!1!==a.click&&document.addEventListener(o,i,!1),!0===a.hashbang&&(t=!0),q)){var b=t&&~p.hash.indexOf("#!")?p.hash.substr(2)+p.search:p.pathname+p.search+p.hash;d.replace(b,null,!0,q)}},d.stop=function(){m&&(d.current="",d.len=0,m=!1,document.removeEventListener(o,i,!1),window.removeEventListener("popstate",u,!1))},d.show=function(a,b,c,e){var f=new g(a,b);return d.current=f.path,!1!==c&&d.dispatch(f),!1!==f.handled&&!1!==e&&f.pushState(),f},d.back=function(a,b){d.len>0?(history.back(),d.len--):a?setTimeout(function(){d.show(a,b)}):setTimeout(function(){d.show(s,b)})},d.redirect=function(a,b){"string"==typeof a&&"string"==typeof b&&d(a,function(a){setTimeout(function(){d.replace(b)},0)}),"string"==typeof a&&"undefined"==typeof b&&setTimeout(function(){d.replace(a)},0)},d.replace=function(a,b,c,e){var f=new g(a,b);return d.current=f.path,f.init=c,f.save(),!1!==e&&d.dispatch(f),f},d.dispatch=function(a){function b(){var a=d.exits[h++];return a?void a(f,b):c()}function c(){var b=d.callbacks[g++];return a.path!==d.current?void(a.handled=!1):b?void b(a,c):e(a)}var f=n,g=0,h=0;n=a,f?b():c()},d.exit=function(a,b){if("function"==typeof a)return d.exit("*",a);for(var c=new h(a),e=1;e<arguments.length;++e)d.exits.push(c.middleware(arguments[e]))},d.Context=g,g.prototype.pushState=function(){d.len++,history.pushState(this.state,this.title,t&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},g.prototype.save=function(){history.replaceState(this.state,this.title,t&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},d.Route=h,h.prototype.middleware=function(a){var b=this;return function(c,d){return b.match(c.path,c.params)?a(c,d):void d()}},h.prototype.match=function(a,b){var c=this.keys,d=a.indexOf("?"),e=~d?a.slice(0,d):a,g=this.regexp.exec(decodeURIComponent(e));if(!g)return!1;for(var h=1,i=g.length;h<i;++h){var j=c[h-1],k=f(g[h]);void 0===k&&hasOwnProperty.call(b,j.name)||(b[j.name]=k)}return!0};var u=function(){var a=!1;if("undefined"!=typeof window)return"complete"===document.readyState?a=!0:window.addEventListener("load",function(){setTimeout(function(){a=!0},0)}),function(b){if(a)if(b.state){var c=b.state.path;d.replace(c,b.state)}else d.show(p.pathname+p.hash,void 0,void 0,!1)}}();d.sameOrigin=k}).call(this,a("_process"))},{_process:2,"path-to-regexp":3}],2:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],3:[function(a,b,c){function d(a){for(var b,c=[],d=0,e=0,f="";null!=(b=q.exec(a));){var g=b[0],i=b[1],j=b.index;if(f+=a.slice(e,j),e=j+g.length,i)f+=i[1];else{f&&(c.push(f),f="");var k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],r="+"===o||"*"===o,s="?"===o||"*"===o,t=k||"/",u=m||n||(p?".*":"[^"+t+"]+?");c.push({name:l||d++,prefix:k||"",delimiter:t,optional:s,repeat:r,pattern:h(u)})}}return e<a.length&&(f+=a.substr(e)),f&&c.push(f),c}function e(a){return f(d(a))}function f(a){for(var b=new Array(a.length),c=0;c<a.length;c++)"object"==typeof a[c]&&(b[c]=new RegExp("^"+a[c].pattern+"$"));return function(c){for(var d="",e=c||{},f=0;f<a.length;f++){var g=a[f];if("string"!=typeof g){var h,i=e[g.name];if(null==i){if(g.optional)continue;throw new TypeError('Expected "'+g.name+'" to be defined')}if(p(i)){if(!g.repeat)throw new TypeError('Expected "'+g.name+'" to not repeat, but received "'+i+'"');if(0===i.length){if(g.optional)continue;throw new TypeError('Expected "'+g.name+'" to not be empty')}for(var j=0;j<i.length;j++){if(h=encodeURIComponent(i[j]),!b[f].test(h))throw new TypeError('Expected all "'+g.name+'" to match "'+g.pattern+'", but received "'+h+'"');d+=(0===j?g.prefix:g.delimiter)+h}}else{if(h=encodeURIComponent(i),!b[f].test(h))throw new TypeError('Expected "'+g.name+'" to match "'+g.pattern+'", but received "'+h+'"');d+=g.prefix+h}}else d+=g}return d}}function g(a){return a.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function h(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function i(a,b){return a.keys=b,a}function j(a){return a.sensitive?"":"i"}function k(a,b){var c=a.source.match(/\((?!\?)/g);if(c)for(var d=0;d<c.length;d++)b.push({name:d,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return i(a,b)}function l(a,b,c){for(var d=[],e=0;e<a.length;e++)d.push(o(a[e],b,c).source);var f=new RegExp("(?:"+d.join("|")+")",j(c));return i(f,b)}function m(a,b,c){for(var e=d(a),f=n(e,c),g=0;g<e.length;g++)"string"!=typeof e[g]&&b.push(e[g]);return i(f,b)}function n(a,b){b=b||{};for(var c=b.strict,d=b.end!==!1,e="",f=a[a.length-1],h="string"==typeof f&&/\/$/.test(f),i=0;i<a.length;i++){var k=a[i];if("string"==typeof k)e+=g(k);else{var l=g(k.prefix),m=k.pattern;k.repeat&&(m+="(?:"+l+m+")*"),m=k.optional?l?"(?:"+l+"("+m+"))?":"("+m+")?":l+"("+m+")",e+=m}}return c||(e=(h?e.slice(0,-2):e)+"(?:\\/(?=$))?"),e+=d?"$":c&&h?"":"(?=\\/|$)",new RegExp("^"+e,j(b))}function o(a,b,c){return b=b||[],p(b)?c||(c={}):(c=b,b=[]),a instanceof RegExp?k(a,b,c):p(a)?l(a,b,c):m(a,b,c)}var p=a("isarray");b.exports=o,b.exports.parse=d,b.exports.compile=e,b.exports.tokensToFunction=f,b.exports.tokensToRegExp=n;var q=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},{isarray:4}],4:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}]},{},[1])(1)}),!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("reqwest",this,function(){function succeed(a){var b=protocolRe.exec(a.url);return b=b&&b[1]||context.location.protocol,httpsRe.test(b)?twoHundo.test(a.request.status):!!a.request.response}function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):a._timedOut?c(a.request,"Request is aborted: timeout"):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,succeed(a)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"];var e="undefined"!=typeof FormData&&b.data instanceof FormData;b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||e||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&"setRequestHeader"in a&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),context[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,"undefined"==typeof j.onreadystatechange||l||(j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return!(j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k)&&(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),b(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,c({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null,h=!1;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=d.xhr&&d.xhr(d)||xhr(d),c.open(e,f,d.async!==!1),setHeaders(c,d),setCredentials(c,d),context[xDomainRequest]&&c instanceof context[xDomainRequest]?(c.onload=a,c.onerror=b,c.onprogress=function(){},h=!0):c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),h?setTimeout(function(){c.send(g)},200):c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){if(null!==a)return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":void 0}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(a){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(a){return error(resp,"Could not parse JSON in response",a)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(a,b,c){for(a=self.request,self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function buildParams(a,b,c,d){var e,f,g,h=/\[\]$/;if(isArray(b))for(f=0;b&&f<b.length;f++)g=b[f],c||h.test(a)?d(a,g):buildParams(a+"["+("object"==typeof g?f:"")+"]",g,c,d);else if(b&&"[object Object]"===b.toString())for(e in b)buildParams(a+"["+e+"]",b[e],c,d);else d(a,b)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(a){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(a){if(a.crossOrigin===!0){var b=context[xmlHttpRequest]?new XMLHttpRequest:null;if(b&&"withCredentials"in b)return b;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(a){return a}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return a=a||function(){},b=b||function(){},this._fulfilled?this._responseArgs.resp=a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this},catch:function(a){return this.fail(a)}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a,b){var c,d,e=b||!1,f=[],g=encodeURIComponent,h=function(a,b){b="function"==typeof b?b():null==b?"":b,f[f.length]=g(a)+"="+g(b)};if(isArray(a))for(d=0;a&&d<a.length;d++)h(a[d].name,a[d].value);else for(c in a)a.hasOwnProperty(c)&&buildParams(c,a[c],e,h);return f.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest.ajaxSetup=function(a){a=a||{};for(var b in a)globalSetupOptions[b]=a[b]},reqwest}),function(a,b){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a.Mustache={},b(a.Mustache))}(this,function(a){function b(a){return"function"==typeof a}function c(a){return p(a)?"array":typeof a}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a,b){return null!=a&&"object"==typeof a&&b in a}function f(a,b){return q.call(a,b)}function g(a){return!f(r,a)}function h(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return s[a]})}function i(b,c){function e(){if(r&&!s)for(;q.length;)delete o[q.pop()];else q=[];r=!1,s=!1}function f(a){if("string"==typeof a&&(a=a.split(u,2)),!p(a)||2!==a.length)throw new Error("Invalid tags: "+a);h=new RegExp(d(a[0])+"\\s*"),i=new RegExp("\\s*"+d(a[1])),m=new RegExp("\\s*"+d("}"+a[1]))}if(!b)return[];var h,i,m,n=[],o=[],q=[],r=!1,s=!1;f(c||a.tags);for(var y,z,A,B,C,D,E=new l(b);!E.eos();){if(y=E.pos,A=E.scanUntil(h))for(var F=0,G=A.length;F<G;++F)B=A.charAt(F),g(B)?q.push(o.length):s=!0,o.push(["text",B,y,y+1]),y+=1,"\n"===B&&e();if(!E.scan(h))break;if(r=!0,z=E.scan(x)||"name",E.scan(t),"="===z?(A=E.scanUntil(v),E.scan(v),E.scanUntil(i)):"{"===z?(A=E.scanUntil(m),E.scan(w),E.scanUntil(i),z="&"):A=E.scanUntil(i),!E.scan(i))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],o.push(C),"#"===z||"^"===z)n.push(C);else if("/"===z){if(D=n.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?s=!0:"="===z&&f(A)}if(D=n.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return k(j(o))}function j(a){for(var b,c,d=[],e=0,f=a.length;e<f;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function k(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;g<h;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function l(a){this.string=a,this.tail=a,this.pos=0}function m(a,b){this.view=a,this.cache={".":this.view},this.parent=b}function n(){this.cache={}}var o=Object.prototype.toString,p=Array.isArray||function(a){return"[object Array]"===o.call(a)},q=RegExp.prototype.test,r=/\S/,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},t=/\s*/,u=/\s+/,v=/\s*=/,w=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},l.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},m.prototype.push=function(a){return new m(a,this)},m.prototype.lookup=function(a){var c,d=this.cache;if(d.hasOwnProperty(a))c=d[a];else{for(var f,g,h=this,i=!1;h;){if(a.indexOf(".")>0)for(c=h.view,f=a.split("."),g=0;null!=c&&g<f.length;)g===f.length-1&&(i=e(c,f[g])),c=c[f[g++]];else c=h.view[a],i=e(h.view,a);if(i)break;h=h.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},n.prototype.clearCache=function(){this.cache={}},n.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=i(a,b)),d},n.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof m?b:new m(b);return this.renderTokens(d,e,c,a)},n.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;i<j;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this.renderSection(e,b,c,d):"^"===f?g=this.renderInverted(e,b,c,d):">"===f?g=this.renderPartial(e,b,c,d):"&"===f?g=this.unescapedValue(e,b):"name"===f?g=this.escapedValue(e,b):"text"===f&&(g=this.rawValue(e)),void 0!==g&&(h+=g);return h},n.prototype.renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(p(i))for(var j=0,k=i.length;j<k;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i||"number"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,e.slice(a[3],a[5]),f),null!=i&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},n.prototype.renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);if(!e||p(e)&&0===e.length)return this.renderTokens(a[4],b,c,d)},n.prototype.renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},n.prototype.unescapedValue=function(a,b){var c=b.lookup(a[1]);if(null!=c)return c},n.prototype.escapedValue=function(b,c){var d=c.lookup(b[1]);if(null!=d)return a.escape(d)},n.prototype.rawValue=function(a){return a[1]},a.name="mustache.js",a.version="2.3.0",a.tags=["{{","}}"];var y=new n;return a.clearCache=function(){return y.clearCache()},a.parse=function(a,b){return y.parse(a,b)},a.render=function(a,b,d){if("string"!=typeof a)throw new TypeError('Invalid template! Template should be a "string" but "'+c(a)+'" was given as the first argument for mustache#render(template, view, partials)');return y.render(a,b,d)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=h,a.Scanner=l,a.Context=m,a.Writer=n,a});var Config={asset_version:2,use_minified:!0,use_asset_version:!0,app_path:"https://app.earthboost.org",api_path:"https://api.earthboost.org"},Pages={},Components={},Const={expire_ms:5e3,title_stem:"EarthBoost",countries:{US:"United States",UK:"United Kingdom"},intro_segment:"/intro",url:{login:"/login",group:"/{name}",logout:"/logout",authorize:"/authorize",dashboard:"/dashboard",group_year:"/{name}/{year}",questions:"/questions/{name}/{year}",save_member:"/savemember/{name}/{year}",save_answer:"/saveanswer/{name}/{year}",remove_member:"/removemember/{name}/{year}",finished_questions:"/questions/finished/{name}",questions_user:"/questions/{name}/{year}/{userid}",save_answer_user:"/saveanswer/{name}/{year}/{userid}"}},URL={goto:function(){var a=Array.prototype.slice.call(arguments),b=function(a){return void 0!=a&&null!=a};page("/"+a.filter(b).join("/"))},group:function(a,b){this.goto(a,b)},login:function(){this.goto("login")},logout:function(){this.goto("logout")},dashbord:function(){this.goto("dashboard")}};String.prototype.supplant=function(a){return this.replace(/{([^{}]*)}/g,function(b,c){var d=a[c];return"string"==typeof d||"number"==typeof d?d:b})},String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},String.prototype.numberCommas=function(){return this.replace(/\B(?=(\d{3})+(?!\d))/g,",")};var DOM=function(a,b){"use strict";function c(a,b){return(b||document).querySelector(a)}function d(a,b){return(b||document).querySelectorAll(a)}function e(a){return a.innerHTML}function f(a){a.innerHTML=""}function g(a,b){var c=document.createElement(a);return b.classes&&(c.className=b.classes),b.html&&(c.innerHTML=b.html),c}function h(a,b){(b||document).appendChild(a)}function i(a,b){(b||document).removeChild(a)}function j(a){var b={},c="input:not(:disabled), textarea:not(:disabled), select:not(:disabled)",d=["checkbox","radio"],e=a.querySelectorAll(c),f=["file","reset","submit","button"];return Array.prototype.slice.call(e).forEach(function(a){var c=a.name;!c||f.indexOf(a.type)>-1||d.indexOf(a.type)>-1&&!a.checked||(/\[\]$/.test(c)&&(c=c.slice(0,-2),void 0===b[c]&&(b[c]=[])),void 0===b[c]?b[c]=a.value:"[object Array]"===Object.prototype.toString.call(b[c])?b[c].push(a.value):b[c]=[b[c],a.value])}),b}function k(a,c,d){var e=b.render(a,c,d||{});return{html:function(){return e},to:function(a){a.innerHTML=e}}}function l(b){b.push(a.title_stem),document.title=b.join(" • ")}return{get:c,find:d,html:e,clear:f,title:l,append:h,create:g,remove:i,render:k,serialize:j}}(Const,Mustache),Message=function(a,b){"use strict";function c(a){g(l,a)}function d(a){g(m,a)}function e(a){var b=!(arguments.length>1)||arguments[1];g(n,a,b)}function f(a){g(o,a)}function g(a,b,c){c=c||!1,i().insert({type:a,message:b},c)}function h(a,b){i().halt(a,b)}function i(){return j||(j=new b.Notifications(k)),j}var j,k=a.get("#notifications"),l="info",m="error",n="success",o="warning";return{halt:h,info:c,error:d,success:e,warning:f}}(DOM,Components),Router=function(a,b){"use strict";function c(a){var b,c=d(f);if(c){if(f===a)return c;c.tearDown()}if(f=a,b=d(a),!b)throw new Error("Failed to find controller '"+a+"'");return b.setup(),b}function d(b){if(b)return b.split(".").map(function(a){return a.capitalize()}).reduce(function(a,b){return a[b]},a)}function e(){b.halt(404,"Page not found")}var f=null,g={AUTH:"auth",GROUP:"group",DASHBOARD:"dashboard",QUESTIONS:"questions"},h={},i={},j={},k={};return j.view=function(a,b){c(g.DASHBOARD).view(a,b)},h.login=function(a,b){c(g.AUTH).login(a,b)},h.checkEmail=function(a,b){c(g.AUTH).checkEmail(a,b)},h.authorize=function(a,b){c(g.AUTH).authorize(a,b)},h.logout=function(a,b){c(g.AUTH).logout(a,b)},i.view=function(a,b){c(g.GROUP).view(a,b)},k.view=function(a,b){c(g.QUESTIONS).view(a,b)},{Auth:h,Group:i,notFound:e,Dashboard:j,Questions:k}}(Pages,Message),Request=function(a,b,c){"use strict";function d(a){o(b.url.dashboard,r,a)}function e(a,c,d){var e={name:a,year:c},f=c?b.url.group_year.supplant(e):b.url.group.supplant(e);o(f,r,d)}function f(a,c,d,e){var f={name:a,year:c,userid:d},g=d?b.url.questions_user.supplant(f):b.url.questions.supplant(f);o(g,r,e)}function g(a,c,d,e){var f=b.url.save_member.supplant({year:c,name:a});o(f,s,e,d)}function h(a,c,d,e){var f=b.url.remove_member.supplant({year:c,name:a});o(f,s,e,{id:d})}function i(a,c,d,e,f,g){var h={year:c,userid:d,name:a},i=d?b.url.save_answer_user.supplant(h):b.url.save_answer.supplant(h);o(i,s,f,e,g)}function j(a,c){o(b.url.login,s,c,a)}function k(a,c){o(b.url.authorize,s,c,{token:a})}function l(a){o(b.url.logout,r,a)}function m(a,b,c){return a.params&&a.params[b]?a.params[b]:c||null}function n(a,b){var c=[],d=null;return location.search.substr(1).split("&").forEach(function(b){c=b.split(a+"=",2),c.length>=2&&(d=decodeURIComponent(c[1]))}),d}function o(b,d,e,f,g){reqwest({type:"json",method:d,data:f||{},crossOrigin:!0,withCredentials:!0,url:a.api_path+b,success:function(a){p(a)&&"function"==typeof e&&e(a.data,a.status)},error:function(a){console.error(a),"function"==typeof g&&g(),c.error("There was a problem with that request.")}})}function p(a){switch(a.code){case 302:return page(a.data.url),q(a.messages),!1;case 401:return page(b.url.login),q(a.messages),!1;case 400:case 403:case 404:case 412:case 500:return c.halt(a.code,a.message),!1;case 200:default:return q(a.messages),a.status===v}}function q(a){a&&a.length&&a.forEach(function(a){a.message&&a.message.length&&c[a.type](a.message)})}var r="get",s="post",t="info",u="error",v="success";return{param:m,group:e,login:j,logout:l,getParam:n,authorize:k,dashboard:d,questions:f,saveMember:g,saveAnswer:i,STATUS_INFO:t,STATUS_ERROR:u,removeMember:h,STATUS_SUCCESS:v}}(Config,Const,Message),Calculator=function(){"use strict";function a(a,e,h,j,k){var e=b(e,h),l=h?i.user:i.group,m=c(a,k,l),n=d(m,j);return j&&n.id?f(n,e.array[j],m,a,k,l):g(m,e)}function b(a,b){var c=0,d=[];return a?(a.forEach(function(a){a.user_id==b&&(c++,d[a.question_id]=a)}),{count:c,array:d}):[]}function c(a,b,c){var d=[],e=c+":"+b.type;return a.forEach(function(a){a.skip_for&&(a.skip_for.indexOf(c)>-1||a.skip_for.indexOf(e)>-1)||d.push(a)}),d}function d(a,b){var c;for(c in a)if(a[c].id==b)return a[c];return{}}function e(a,b,c,d){var e,f,g=d+":"+c.type;for(e in b)if(f=b[e],f.id==a){if(!f.skip_for||!(f.skip_for.indexOf(d)>-1||f.skip_for.indexOf(g)>-1))return f.id;a=f.goto}return a}function f(a,b,c,d,f,g){var l,m=0,n=0,o=b?b.select:"",p=f.type===h.office?"employees":"family members",q=g===i.group?"or your "+p:"",r={select:!1,choices:!1,id:a.id,type:a.type,hint:a.hint,label:a.label,heading:a.heading,group:k[a.group],value:b?b.answer:"",input_suffix:a.input_suffix,radio:a.type==j.radio,number:a.type==j.number,checkbox:a.type==j.checkbox,goto:e(a.goto,d,f,g)};for(l in c)c[l].group==a.group&&(n++,c[l].id==a.id&&(m=n));if(a.choices&&(r.choices=[],a.choices.forEach(function(a){r.choices.push({name:a.name,label:a.label,value:a.value,goto:e(a.goto,d,f,g),selected:a.value.toString()==r.value.toString()})})),a.select){r.select=[];for(l in a.select)r.select.push({label:l,value:a.select[l],selected:a.select[l].toString()==o})}return r.index=m,r.total=n,r.label=r.label.replace("%GROUP%",q),r.progress=Math.round((m-1)/n*100),r}function g(a,b){var c,d,e,f={transportation:{total:0,answered:0,icon:"train",name:"Transportation"},energy:{total:0,answered:0,name:"Energy",icon:"lightbulb"},home_office:{total:0,answered:0,icon:"home",name:"Home and Office"
}};for(c in a)e=a[c],f[e.group].total+=1,b.array[e.id]?f[e.group].answered+=1:d||(d=e.id);return f=Object.keys(f).map(function(a){return f[a]}),{goto:d,groups:f,show_intro:!0,start_id:a[0].id,answer_count:b.count,complete:b.count>=a.length,progress:Math.round(Math.min(b.count,a.length)/a.length*100)}}var h={home:"home",office:"office"},i={user:"user",group:"group"},j={text:"text",radio:"radio",number:"number",select:"select",checkbox:"checkbox"},k={energy:"Energy",home_office:"Home and Office",transportation:"Transportation"};return{get:a,TYPES:j}}(Const,Mustache);Pages.Auth=function(a,b,c){"use strict";function d(){j=new c.Nav(b.get("nav")),k=new c.Login(b.get("main"))}function e(){k&&k.tearDown()}function f(a,c){b.title(["Login"]),j.clear(),k.render()}function g(a,c){b.title(["Check Your Email"]),j.clear(),k.renderNotice()}function h(b,c){a.authorize(a.getParam("token"),function(a){page(Const.url.dashboard)})}function i(b,c){a.logout(function(a){page(Const.url.login)})}var j,k;return{login:f,setup:d,logout:i,tearDown:e,authorize:h,checkEmail:g}}(Request,DOM,Components),Pages.Dashboard=function(a,b,c){"use strict";function d(){b.title(["Dashboard"]),g=new c.Nav(b.get("nav")),h=new c.Dashboard(b.get("main"))}function e(){h&&h.tearDown()}function f(b,c){a.dashboard(function(a){g.render({year:null,group:null,user:a.user,groups:a.groups}),h.render({groups:a.groups})})}var g,h;return{view:f,setup:d,tearDown:e}}(Request,DOM,Components),Pages.Group=function(a,b,c){"use strict";function d(){g=new c.Nav(b.get("nav")),h=new c.Group(b.get("main"))}function e(){g&&g.tearDown(),h&&h.tearDown()}function f(c,d){a.group(a.param(c,"group"),a.param(c,"year"),function(a){b.title([a.group.label]),g.render({user:a.user,year:a.year,group:a.group,groups:a.groups}),h.render({user:a.user,year:a.year,task:a.task,group:a.group,groups:a.groups,members:a.members,locales:a.locales,is_admin:a.is_admin,emissions:a.emissions,offset_amount:a.offset_amount})})}var g,h;return{view:f,setup:d,tearDown:e}}(Request,DOM,Components),Pages.Questions=function(a,b,c,d){"use strict";function e(){k=new c.Nav(b.get("nav")),l=new c.Calculator(b.get("main"),i)}function f(){n=!1,k&&k.tearDown(),l&&l.tearDown()}function g(c,e){var f=a.param(c,"questionid");return n===!0?void h(f):void a.questions(a.param(c,"group"),a.param(c,"year"),a.param(c,"userid"),function(a){return j(a.questions,f)?(m=a,n=!0,b.title(["Carbon Calculator",m.group.name]),k.renderCalculator(m.group.name,m.year,m.user),void h(f)):void d.halt(404,"That question doesn't exist.")})}function h(a,b){return b=b||!1,b&&!j(m.questions,a)?void d.halt(404,"That question doesn't exist."):void l.render({mode:m.mode,user:m.user,year:m.year,group:m.group,answers:m.answers,question_id:a,questions:m.questions,emissions:m.emissions,offset_amount:m.offset_amount})}function i(b,c){a.saveAnswer(m.group.name,m.year,m.user.id,b,function(a,b){m.answers=a.answers,m.emissions=a.emissions,m.offset_amount=a.offset_amount,c()})}function j(a,b){var c;if(!a)return!1;if(!b||!b.length||b==o)return!0;for(c in a)if(a[c].id==b)return!0;return!1}var k,l,m,n=!1,o="intro";return{view:g,setup:e,tearDown:f}}(Request,DOM,Components,Message),Components.AddMemberForm=function(a,b,c){"use strict";return function(d){function e(b,c,e,h,n,p){i=h,j=c,k=n,l=b,m=e,p=p||{id:"",name:"",email:"",is_admin:0,is_champion:0,locale:"US-NY",locale_months:12},p.locales=g(k,p.locale),a.render(o.addForm,p).to(d),a.get('input[name="name"]').focus(),a.get("a.cancel").onclick=l,a.get("form").onsubmit=f}function f(c){return c.preventDefault(),b.saveMember(m,i,a.serialize(this),j),!1}function g(a,b){var d,e,f,g,h=[];for(g in a){if(d={regions:[],country:c.countries[g]},!c.countries[g])return;for(e in a[g])f=g+"-"+e,d.regions.push({code:f,selected:f==b,region:a[g][e].name});h.push(d)}return h}function h(){i=null,j=null,k=null,l=null,n=null,m=null}var i,j,k,l,m,n=a.get("#add-member-form"),o={addForm:a.html(n)};return{render:e,tearDown:h}}}(DOM,Request,Const),Components.Calculator=function(a,b,c){"use strict";return function(d,e){function f(b){l=b,g(l),d.className="calculator",a.render(p.questions,l,p).to(d),h(),i()}function g(a){var c=b.get(a.questions,a.answers,a.user.id,a.question_id,a.group);m={year:a.year,userid:a.user.id,name:a.group.name},a.emissions=a.emissions.toFixed(1),a.offset_amount=a.offset_amount.toFixed(2).toString().numberCommas(),a.url_stem=a.user.id?Const.url.questions_user.supplant(m):Const.url.questions.supplant(m),a.url_back=Const.url.group_year.supplant(m),a.question=c}function h(){var b=a.get('input[type="number"]');b&&b.focus()}function i(){var b=a.get("button.back"),c=a.get('form[name="question"]');b&&(b.onclick=function(a){window.history.back(),a.preventDefault()}),c&&(c.onsubmit=j)}function j(d){var f,g,h=a.get('form[name="question"]'),i=a.get('input[name="answer"]'),j=i?i.value:null,k=a.get('select[name="select"]'),n=a.get('input[name="id"]').value,o=l.user.id?Const.url.questions_user.supplant(m):Const.url.questions.supplant(m),p=h.dataset.type;switch(p){case b.TYPES.radio:g=a.get('input[name="answer"]:checked'),j=g?g.value:j;break;case b.TYPES.number:g=a.get('input[type="number"]');break;default:g=h,j=a.serialize(h),delete j.id}d.preventDefault(),f=g?g.dataset.goto:null,e({answer:j,question_id:n,select:k?k.value:null},function(){f?page(o+"/"+f):(page(Const.url.group_year.supplant(m)),c.success("Wonderful! You've finished calculating your carbon emissions! You can edit these answers at any time. Look for the <i class='icon icon-edit'></i> icon.",!1))})}function k(){p={},l=null,a.clear(d),d.className=""}var l,m,n=a.get("#question"),o=a.get("#questions"),p={question:a.html(n),questions:a.html(o)};return{render:f,tearDown:k}}}(DOM,Calculator,Message),Components.Dashboard=function(a){"use strict";return function(b){function c(c){c.groups.forEach(function(a){a.member_label=a.group_type==g?"Employee":"Housemate",a.is_admin=1==a.is_admin,a.is_champion=1==a.is_champion}),b.className="dashboard",a.render(f.dashboard,c).to(b)}function d(){f={},e=null,b.className=""}var e=a.get("#dashboard"),f={dashboard:a.html(e)};const g="office";return{render:c,tearDown:d}}}(DOM),Components.Group=function(a,b){"use strict";return function(c){function d(b){n=b,e(n),f(n),c.className="group",a.render(s.group,n,s).to(c),g(),h()}function e(a){a.user.is_admin=a.is_admin,a.emissions=a.emissions.toFixed(1),a.offset_amount=a.offset_amount.toFixed(2).toString().numberCommas(),a.members.forEach(function(c){c.emissions=c.emissions.toFixed(1),c.offset_amount=c.offset_amount.toFixed(2).toString().numberCommas(),c.is_standard=1==c.is_standard,c.edit_url=b.url.questions_user.supplant({year:a.year,userid:c.user_id,name:a.group.name})+b.intro_segment}),a.members.sort(function(a,b){return a.name>b.name?1:b.name>a.name?-1:0}),a.member=k(a.user.id,"user_id"),a.member.profile=a.user.profile}function f(a){var c=a.task,d=t[a.group.type];if(a.task)switch(c.key){case"add_member":c.color="blue",c.url="javascript:;",c.classes="add-member",c.label="Add a Staff Member";break;case"group_profile":c.color="purple",c.url=b.url.questions.supplant({year:a.year,name:a.group.name}),c.label="Complete "+d+" Profile";break;case"user_profile":c.color="blue",c.label="Complete Your Profile",c.url=b.url.questions_user.supplant({year:a.year,userid:a.user.id,name:a.group.name})+b.intro_segment;break;case"group_notify":c.url="#",c.color="purple",c.label="Notify Your "+d;break;case"canopy_club":c.url="#",c.color="green",c.label="Join the Canopy Club!"}}function g(){o=a.find(".add-member",c),[].forEach.call(o,function(a){a.onclick=i})}function h(){var b=a.get(".panel");b.addEventListener("click",function(a){var b=a.target;"edit-member"===b.className?i(null,k(b.dataset.id)):"remove-member"===b.className&&j(b.dataset.id)},!1)}function i(b,c){var e=a.get(".panel");m=new Components.AddMemberForm(e),m.render(function(){a.render(s.members,n).to(e),g()},function(a){var b=a.member;d(a),i(null,c?b:void 0)},n.group.name,n.year,n.locales,c)}function j(a){var b=confirm("Are you sure you want to remove this group member?Their data will not be lost, but you will need to re-add them by email to restore it.");b&&Request.removeMember(n.group.name,n.year,a,function(a){d(a)})}function k(a,b){return b=b||"id",n.members.filter(function(c){return c[b]==a})[0]}function l(){s={},n=null,q=null,o=null,c.className=""}var m,n,o,p=a.get("#task"),q=a.get("#group"),r=a.get("#members"),s={task:a.html(p),group:a.html(q),members:a.html(r)},t={home:"Home",office:"Company"};return{render:d,tearDown:l}}}(DOM,Const),Components.Login=function(a){"use strict";return function(b){function c(){b.className="login",a.render(i.login,{}).to(b),a.get("form").onsubmit=e}function d(){b.className="login",a.render(i.login_notice,{}).to(b)}function e(b){return b.preventDefault(),Request.login(a.serialize(this),function(a){console.log(a)}),!1}function f(){i={},g=null,b.className=""}var g=a.get("#login"),h=a.get("#login-notice"),i={login:a.html(g),login_notice:a.html(h)};return{render:c,tearDown:f,renderNotice:d}}}(DOM),Components.Nav=function(a,b){"use strict";return function(c){function d(b){var d=b.group?b.group.name:null;b.groups.forEach(function(a){a.selected=a.group_name==d&&a.year==b.year}),b.showLogout=!0,b.showGroupSelect=!0,a.render(k.nav,b).to(c),i=a.get("select",c),i.onchange=h}function e(b,d,e){var f={year:d,userName:e.name,groupName:b,showCalculator:!0,showUserName:e.id&&e.name};a.render(k.nav,f).to(c)}function f(){k={},j=null,i=null}function g(){a.clear(c)}function h(a){var c=this.value.split(".");b.group(c[0],c[1])}var i,j=a.get("#nav"),k={nav:a.html(j)};return{clear:g,render:d,tearDown:f,renderCalculator:e}}}(DOM,URL),Components.Notifications=function(a,b){"use strict";return function(c){function d(d,e){var f,g=a.create("div",{classes:"notification",html:a.render(i.notification,d).html()});a.append(g,c),a.get(".close",g).onclick=function(b){a.remove(g,c),f&&clearTimeout(f)},e===!0&&(f=setTimeout(function(){a.remove(g,c)},b.expire_ms))}function e(){var b,d=a.find(".notification");for(b=0;b<d.length;b++)a.remove(d[b],c)}function f(b,c){a.render(i.error,{code:b,message:c}).to(a.get("main"))}var g=a.get("#error"),h=a.get("#notification"),i={error:a.html(g),notification:a.html(h)};return{halt:f,insert:d,closeAll:e}}}(DOM,Const),page("/",Router.Dashboard.view),page("/login",Router.Auth.login),page("/logout",Router.Auth.logout),page("/authorize",Router.Auth.authorize),page("/check-email",Router.Auth.checkEmail),page("/questions/:group/:year/:userid/:questionid",Router.Questions.view),page("/questions/:group/:year/:questionid",Router.Questions.view),page("/questions/:group/:year",Router.Questions.view),page("/:group/:year",Router.Group.view),page("/:group",Router.Group.view),page("*",Router.notFound),page();